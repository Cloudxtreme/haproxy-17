global
  chroot  /var/lib/haproxy
  user    haproxy
  group   haproxy

defaults redis
  mode    tcp
  timeout connect 3s
  timeout client 6s
  timeout server 6s

frontend redis
  bind *:6379 name redis
  default_backend redis

backend redis
  option    tcp-check
  tcp-check connect
  tcp-check send PING\r\n
  tcp-check expect string +PONG
  tcp-check send info\ replication\r\n
  tcp-check expect string role:master
  tcp-check expect rstring connected_slaves:[1-9][0-9]*
  tcp-check send QUIT\r\n
  tcp-check expect string +OK
  balance   first
  server    redis_1 redis_1:6379 check inter 1s
  server    redis_2 redis_2:6379 check inter 1s
  server    redis_3 redis_3:6379 check inter 1s
